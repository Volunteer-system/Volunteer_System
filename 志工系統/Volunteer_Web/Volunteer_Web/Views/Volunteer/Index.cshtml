
@{
    ViewBag.Title = "Index";
}
<h2>Index</h2>

<div id="calendar1"></div>
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog ">
        <div class="modal-content ">
            <div class=" modal-header ">
                <h4 class=" modal-title"><span id="eventTitle"></span></h4>
                <button type="button" class=" close " data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body ">
                @*<p id="pDetails"></p>*@
                <div class="form-group row  table-bordered">
                    <label for="a_summy" class="col-sm-4 col-form-label">活動簡介:</label>
                    <div class="col-sm-8">
                        <input type="text" readonly class="form-control-plaintext" id="a_summy" value="">
                    </div>
                </div>
                <div class="form-group row  table-bordered">
                    <label for="a_startdate" class="col-sm-4 col-form-label">活動開始日期:</label>
                    <div class="col-sm-8">
                        <input type="text" readonly class="form-control-plaintext" id="a_startdate" value="">
                    </div>
                </div>
                <div class="form-group row  table-bordered">
                    <label for="a_enddate" class="col-sm-4 col-form-label">活動結束日期:</label>
                    <div class="col-sm-8">
                        <input type="text" readonly class="form-control-plaintext" id="a_enddate" value="">
                    </div>
                </div>
                <div class="form-group row  table-bordered">
                    <label for="a_photo" class="col-sm-4 col-form-label">活動照片:</label>
                    <div class="col-sm-8">
                        <img id="a_photo" src=" @Url.Action("GetImageByID","Volunteer",new { id = Session["photo"]})"/>
                    </div>
                </div>
            </div>
            <div class="modal-footer ">
                <button type="button" class="btn btn-default " data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
@section calendar{
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.print.css" rel="stylesheet" media="print" />
<script src="~/Scripts/jquery-3.3.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>
<script>
    $(document).ready(function () {      
            var events = [];
            $.ajax({
                type: "GET",
                url: "/Volunteer/GetCalendar/@ViewBag.userID",
                success: function (datas) {
                    $.each(datas, function (index, value) {
                        events.push({
                            title:"活動:"+value.Activity_name,
                            start: value.Activity_startdate,
                            end: value.Activity_enddate,
                            act_no: value.Activity_no,
                            photo: value.Activity_Photo_id
                        });
                    })
                   GenerateCalendar(events);
                },
                error: function (data) {
                    alert("沒有資料");
                }
            })
            //==============================================產生月曆▼===============================================
            function GenerateCalendar(events)
            {
                $("#calendar1").fullCalendar("destroy");
                $("#calendar1").fullCalendar({
                    contentHeight: 400,
                    defaultDate: new Date(),
                    header: { left: "prev,today,next", center: "title", right: "" },
                    buttonText: { today: "今天", prev: "上個月", next: "下個月" },
                    views: {
                        month: { titleFormat: "YYYY年MM月" }
                    },
                    dayNamesShort: ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'],
                    eventLimit: true,
                    eventColor: "#ff7575",
                    events: events,
                    eventClick: function (calEvent, jsEvent, view) {
                        $(this).attr({ "data-toggle": "modal", "data-target": "#myModal" });
                        $.getJSON("/Volunteer/GetCalendarJson/" + calEvent.act_no, function (datas) {
                            $.each(datas, function (index, vals) {
                                $("#eventTitle").text(calEvent.title);
                                $("#a_summy").val(vals.Summary);
                                $("#a_startdate").val(vals.Activity_startdate);
                                $("#a_enddate").val(vals.Activity_enddate);//                             
                            });
                        });
                    }

                });
        }

        });
</script>
    }