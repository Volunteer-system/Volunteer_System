@{
    ViewBag.Title = "NewVolunteer";
}
@section Home_style{
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }

        #social {
            height: 40px;
            width: 350px;
        }

        #student {
            height: 40px;
            width: 350px;
        }

        #content{
            width:auto;
            
        }

        #social_label {
            height:400px;
            margin: auto,auto
        }
        .social_img {
            height: 100% !important;
            width: 100% !important;
        }

        #student_label {
            height: 400px;
            margin: auto
        }

        .student_img {
            height: 100% !important;
            width: 100% !important;
        }

    </style>
}


<div class="row mt-4">
    <div class="col-lg-3">
        <div class="btn btn-block">
            申請步驟
        </div>
        <table class="table table-bordered">
            <thead></thead>
            <tbody id="td1">
                <tr><td><a href="~/Home/NewVolunteer/1" id="Kind_of" class="btn btn-outline-info btn-block" value="Kind_of">申請須知</a></td></tr>
                @*<tr><td><a href="~/Home/NewVolunteer/1" class="btn btn-outline-info btn-block" value="Requirements">申請須知</a></td></tr>*@
                <tr><td><a href="~/Home/NewVolunteer/2" id="basic_info" class="btn btn-outline-info btn-block" value="basic_info">基本資料</a></td></tr>
                <tr><td><a href="~/Home/NewVolunteer/3" id="Questionnaire" class="btn btn-outline-info btn-block" value="Questionnaire">問券調查</a></td></tr>
                <tr><td><a href="~/Home/NewVolunteer/4" id="Service_period" class="btn btn-outline-info btn-block" value="Service_period">服務時段調查</a></td></tr>
                <tr><td><a href="~/Home/NewVolunteer/5" id="Interview_period" class="btn btn-outline-info btn-block" value="Interview_period">可面試時間</a></td></tr>
                <tr><td><a href="~/Home/NewVolunteer/6" id="Alldata_check" class="btn btn-outline-info btn-block" value="Alldata_check">資料確認</a></td></tr>
                <tr><td><a href="~/Home/NewVolunteer/7" id="Requirement_ok" class="btn btn-outline-info btn-block" value="Requirement_ok">申請完成</a></td></tr>
            </tbody>
        </table>
    </div>
    <div class="col-lg-9">
        <div class="card-body">
            @{
                string Partilview = ViewBag.Partilview;
            }
            @Html.Action(Partilview)
        </div>
    </div>
</div>
@section Home_script{

    <script>

    $(document).ready(function () {
        //===========================================按下接受條約才可開始申請志工========================================
        $('a[value = "@ViewBag.Partilview"]').addClass('active');

             @{
                 if (Session["Agree"] == null)
                 {
                 @: $('#td1 a').addClass('list-group-item disabled');
                 }
                 else
                 {
                    @: $('#td1 a').removeClass('list-group-item disabled');
                }
            }
            //=========================================面試、服務時段=======================================================



                  //服務時段自動匯入
           @{
               if (ViewBag.Partilview == "Service_period") {

                  var data =TempData["data"] as Volunteer_Web.ViewModel.Service_period_VM;

               foreach (var i in data.wish1)
                   {
               @:$("td[data-service_period_no='" + @i + "']").find($("p")).text("1");
                }
                   if (data.wish2 != null)
                   {
                   foreach (var i in data.wish2)
                   {
                   @:$("td[data-service_period_no ='" + @i + "']").find($("p")).text("2");
                   }
                   }

                   if (data.wish3 != null)
                   {
                       foreach (var i in data.wish3)
                       {
               @:$("td[data-service_period_no ='" + @i + "']").find($("p")).text("3");
                }
                   }
               }

}


                //面試時段自動匯入
             @{
                 if (ViewBag.Partilview == "Interview_period")
                 {

                     var data = TempData["data"] as Volunteer_Web.ViewModel.Interview_period_VM;

                     foreach (var i in data.wish1)
                     {
               @:$("td[data-service_period_no='" + @i + "']").find($("p")).text("1");
                }


    }

}
        //可面試時段、排班意願時段的檢查
        var btn_edit = $("#btn_edit");
        var btn_insert = $("#btn_insert");
        var btn_insert_interview = $('#btn_insert_interview');
        var select = $("td>p");
        var pv_title = $("#Pv_title");
        var identity_check = $('#identity_check').text();

        btn_edit.click(function () {
            switch ($(this).text()) {
                case "編輯":
                    $(this).text("完成").removeClass("btn-info").addClass("btn-danger")
                    select.attr("contenteditable", true).css("border", "1px solid black")
                    break;
                case "完成":
                    $(this).text("編輯").removeClass("btn-danger").addClass("btn-info")
                    select.attr("contenteditable", false).css("border", "none")
                    break;
            }
        });
        //檢查使用者輸入時段志願
        if (pv_title.text() == "面試時間調查") {
            var re_interview = /^[1]{1}$/;
            select.keyup(function () {
                if (!re_interview.test($(this).text())) {
                    alert("請依照說明填寫");
                    $(this).text("");
                }
            });
        }
        else if (pv_title.text() == "服務時段調查") {
            var re_service = /^[1-3]{1}$/;
            select.keyup(function () {
                if (!re_service.test($(this).text())) {
                    alert("請依照說明填寫");
                    $(this).text("");
                }
            });
        }




        //暫存--可服務時間
        btn_insert.click(function () {
            if (btn_edit.text() == "完成") {
                alert("請先完成編輯");
            }
            else {
                var wish_1st = [];
                var wish_2nd = [];
                var wish_3rd = [];
                $("td").children("p").each(function () {
                    switch ($(this).text()) {
                        case "1":
                            wish_1st.push($(this).parents("td").data("service_period_no"));
                            break;
                        case "2":
                            wish_2nd.push($(this).parents("td").data("service_period_no"));
                            break;
                        case "3":
                            wish_3rd.push($(this).parents("td").data("service_period_no"));
                            break;
                    }
                });
                if (wish_1st.length == 0) {
                    alert("至少要有1個志願1");
                }
                else if (wish_3rd.length != 0 && wish_2nd.length == 0) {
                    alert("缺少志願2，不能直接選志願3")
                }
                else {

                    $.ajax({
                        type: "post",
                        url: "/Home/Service_period",
                        data: { "wish_1st": wish_1st, "wish_2nd": wish_2nd, "wish_3rd": wish_3rd }
                    }).done(function (data) {
                        alert(data);
                    });
                }
            }
        });

        //暫存--可面試時間
        btn_insert_interview.click(function () {
            if (btn_edit.text() == "完成") {
                alert("請先完成編輯");
            }
            else {
                var wish_1st = [];
                $("td").children("p").each(function () {
                    if ($(this).text() == 1)
                        wish_1st.push($(this).parents("td").data("service_period_no"));
                }
                )
                if (wish_1st.length == 0) {
                    alert("至少需要有一時段");
                }
                else {

                    $.ajax({
                        type: "post",
                        url: "/Home/Interview_period",
                        data: { "wish_1st": wish_1st }
                    }).done(function (data) {
                        alert(data);
                    });
                }
            }
        });

        //====================================================最終確認畫面的存檔前檢查=============================================
        var all_basic = $('#check_basic label');
        var OKinsert = 0;

        $('#Allcheck').click(function () {

            var identity_check = $('#identity_check');
                        //檢查是否重複申請
            $.ajax({
                data: { identity: identity_check.text() },
                type: 'post',
                url: '/Home/identity_check'
            }).done(function (data) {
                if (data != "") {
                    OKinsert += 1;
                    alert(data);
                }
                })


            //檢查個資=========================================================================================

            //身分證
            var Reg_identity = /^[A-Za-z][12]\d{8}$/;
            if (!Reg_identity.test($('#identity_check').text())) {
                alert("身份證字號有誤喔")
                }
            //電話
            var Reg_mobile = /^09[0-9]{2}-[0-9]{6}$/
            var mobile = $('#mobile');
            if (mobile.text() != "無" && !Reg_mobile.test(mobile.text())) {
                alert("電話有誤喔，輸入格式 XXXX - XXXXXXX");
            }



            //是否都有填
            all_basic.each(function () {
                if ($(this).text() == "") {
                    var thenull = $(this).parents("tr").children('td:nth-child(1)').text();
                    alert(thenull + "尚未填寫喔");
                    OKinsert += 1;
                }

            })

            //檢查問卷
            var all_quest = $('#check_quest label');
            all_quest.each(function () {
                if ($(this).text() == "") {
                    var thenull = $(this).parents("tr").children('td:nth-child(1)').text();
                    alert(thenull + "尚未填寫喔");
                    OKinsert += 1;
                }

            })


            //檢查服務時段
            $.ajax({
                url: '/Home/Check_period',
                type: 'get',
                //dataType:"text/UTF-8",
                data: ""
            }).done(function (data) {
                if (data != "") {
                    alert(data);
                    OKinsert += 1;
                }
                else {}
            });

            //檢查完後可存檔
            if (OKinsert == 0) {
                alert("辛苦了，您現在可以申請囉");
                $("#OKinsert").removeClass('disabled');
            }


        });
        })






        //============================選擇志工類型============================
        var _choose = $('#Kind_of_choose');





        _choose.mouseleave(function () {
            $("*").stop(true);
            $(this).animate({
                'width': '700px', 'duration': '300'
            });
            $('#student').animate({ 'width': '350px', 'duration': '300' });
            $('#social').animate({ 'width': '350px', 'duration': '300' });
            $("#content").width(0).html("");



            //檢視時圖片回來
            $('#social_td').html('<img class="social_img" src="/Images/images(2).jpg" />');
            $('#student_td').html('<img class="student_img" src="/Images/images (1).jpg" />');
        }) 

        var soc = $('#social');
        var stu = $('#student');


        soc.mouseover(function () {
            $("*").stop(true);

            $("#Kind_of_choose").animate({
                'width': '800px',
                'duration': '300'});
            $('#student').animate({ 'width': '70px', 'duration': '300' });
            $('#social').animate({ 'width': '130px' }, 300, function () {

                $("#content").width('600').load("@Url.Action("Requirements","Home")");
                $('#content').animate({ 'opacity': '1' }, 1000)
            });

            //檢視時圖片去掉
            $('#social_td').html('<div style="background-color:antiquewhite" class="social_img"></div>');
            $('#student_td').html('<div style="background-color:aqua" class="social_img"></div>');
            })


        stu.mouseover( function () {
            $("*").stop(true);
            $("#Kind_of_choose").animate({
                'width': '800px',
                'duration': '300'
            });
            $('#social').animate({ 'width': '70px', 'duration': '300' });

          
            $('#student').animate({ 'width': '130px' }, 300, function () {
                $("#content").text("");
               $("#content").width('600').load("@Url.Action("Requirements","Student")");
                $('#content').animate({'opacity':'1'},1000)
            })

            //檢視時圖片去掉
            $('#social_td').html('<div style="background-color:antiquewhite" class="social_img"></div>');
            $('#student_td').html('<div style="background-color:aqua" class="social_img"></div>');
        })





    </script>
}